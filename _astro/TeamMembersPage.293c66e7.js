import{_ as I,h as u,p as $}from"./hooks.module.7cc4e70a.js";import{c as D,h as B,d as z,a as L,b as j}from"./http.82ebf0f1.js";import{u as A}from"./use-toast.fb52de5d.js";import{o as e}from"./jsxRuntime.module.afbf92fe.js";import{u as F}from"./use-auth.13ac07ad.js";import{p as f}from"./page.c1a8a472.js";import{u as P}from"./use-team-id.3d0ab368.js";import{u as R}from"./use-outside-click.85d1a62f.js";import{k as O}from"./preact.module.7b19fc78.js";import{R as E}from"./RoleDropdown.0bcc7fe3.js";import{g as V}from"./browser.bcc09af3.js";import{u as Y}from"./index.c54070cf.js";import{a as q}from"./team.12f2469e.js";import"./jwt.f0e0aa9c.js";import"./toast.1fe7142d.js";import"./index.a98c85f5.js";const G="/_astro/more-vertical.bfff43ef.svg";function H({member:n,onUpdateMember:t,onDeleteMember:l,onResendInvite:p,isDisabled:o=!1}){const d=I(null),[i,s]=u(!1),[h,c]=u(!1);R(d,()=>{s(!1)});const m=[{name:"Delete",handleClick:()=>{l(),s(!1)}},{name:"Update Role",handleClick:()=>{t(),s(!1)}},...["invited"].includes(n.status)?[{name:"Resend Invite",handleClick:()=>{p(),s(!1)}}]:[]];return e("div",{className:"relative",children:[e("button",{disabled:o,onClick:()=>s(!i),className:"ml-2 flex items-center opacity-60 transition-opacity hover:opacity-100 disabled:cursor-not-allowed disabled:opacity-30",children:e("img",{alt:"menu",src:G,className:"h-4 w-4"})}),i&&e("div",{ref:d,className:"align-right absolute right-0 top-full z-50 mt-1 w-32 rounded-md bg-slate-800 px-2 py-2 text-white shadow-md",children:e("ul",{children:m.map((b,x)=>e("li",{children:e("button",{onClick:b.handleClick,disabled:h,className:"flex w-full cursor-pointer items-center rounded p-2 text-sm font-medium text-slate-100 hover:bg-slate-700",children:b.name})},x))})})]})}function J(n){const{onClose:t}=n,l=I(null),p=I(null),[o,d]=u(""),[i,s]=u(!1),[h,c]=u(""),{teamId:m}=P();$(()=>{c(""),d(""),p?.current?.focus()},[]);const b=async g=>{if(g.preventDefault(),s(!0),c(""),o.toUpperCase()!=="LEAVE"){c("Verification text does not match"),s(!1);return}const{response:w,error:v}=await D(`https://api.roadmap.sh/v1-leave-team/${m}`,{});if(v||!w){s(!1),c(v?.message||"Something went wrong");return}window.location.href="/account?c=tl"},x=()=>{s(!1),c(""),d(""),t()};return R(l,x),e("div",{class:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e("div",{class:"relative h-full w-full max-w-md p-4 md:h-auto",children:e("div",{ref:l,class:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e("h2",{class:"text-2xl font-semibold text-black",children:"Leave Team"}),e("p",{className:"text-gray-500",children:"You will lose access to the team, the roadmaps and progress of other team members."}),e("p",{className:"-mb-2 mt-3 text-base font-medium text-black",children:'Please type "leave" to confirm.'}),e("form",{onSubmit:b,children:[e("div",{className:"my-4",children:[e("input",{ref:p,type:"text",name:"leave-team",id:"leave-team",className:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:border-gray-400",placeholder:'Type "leave" to confirm',required:!0,autoFocus:!0,value:o,onInput:g=>d(g.target.value)}),h&&e("p",{className:"mt-2 rounded-lg bg-red-100 p-2 text-red-700",children:h})]}),e("div",{className:"flex items-center gap-2",children:[e("button",{type:"button",disabled:i,onClick:x,className:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e("button",{type:"submit",disabled:i||o.toUpperCase()!=="LEAVE",className:"flex-grow cursor-pointer rounded-lg bg-red-500 py-2 text-white disabled:opacity-40",children:i?"Please wait ..":"Leave Team"})]})]})]})})})}function K(n){const[t,l]=u(!1);return e(O,{children:[t&&e(J,{onClose:()=>{l(!1)}}),e("button",{onClick:()=>{l(!0)},className:"flex h-7 min-w-[95px] items-center justify-center rounded-md border border-gray-200 bg-gray-50 px-2 py-1.5 text-sm font-medium leading-none text-red-600",children:"Leave team"})]})}function Q(n){const{onClose:t,onInvited:l}=n,p=I(null),o=I(null),[d,i]=u("member"),[s,h]=u(""),[c,m]=u(!1),[b,x]=u(""),{teamId:g}=P();$(()=>{o?.current?.focus()},[]);const w=async y=>{y.preventDefault(),m(!0),x("");const{response:C,error:k}=await B(`https://api.roadmap.sh/v1-invite-member/${g}`,{email:s,role:d});if(k||!C){m(!1),x(k?.message||"Something went wrong");return}m(!1),v(),l()},v=()=>{m(!1),x(""),t()};return R(p,v),e("div",{class:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e("div",{class:"relative h-full w-full max-w-md p-4 md:h-auto",children:e("div",{ref:p,class:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e("h3",{class:"mb-1.5 text-xl sm:text-2xl font-medium",children:"Invite Member"}),e("p",{className:"mb-3 text-sm leading-none text-gray-400 hidden sm:block",children:"Enter the email and role below to invite a member."}),e("form",{onSubmit:w,children:[e("div",{className:"mt-0 sm:mt-4 my-4 flex flex-col gap-2",children:[e("input",{ref:o,type:"email",name:"invite-member",id:"invite-member",className:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:border-gray-400",placeholder:"Enter email address",required:!0,autoFocus:!0,value:s,onInput:y=>h(y.target.value)}),e("div",{className:"flex h-[42px] w-full flex-col",children:e(E,{className:"h-full w-full",selectedRole:d,setSelectedRole:i})}),b&&e("p",{className:" rounded-md border border-red-300 bg-red-50 p-2 text-sm text-red-700",children:b})]}),e("div",{className:"flex items-center gap-2",children:[e("button",{type:"button",disabled:c,onClick:v,className:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e("button",{type:"submit",disabled:c||!s,class:"flex-grow cursor-pointer rounded-lg bg-black py-2 text-center text-white disabled:opacity-40",children:c?"Please wait ..":"Invite"})]})]})]})})})}function W(n){const{onClose:t,onUpdated:l,member:p}=n,o=I(null),[d,i]=u(p.role),[s,h]=u(!1),[c,m]=u(""),{teamId:b}=P(),x=async w=>{w.preventDefault(),h(!0),m("");const{response:v,error:y}=await z(`https://api.roadmap.sh/v1-update-member-role/${b}/${p._id}`,{role:d});if(y||!v){h(!1),m(y?.message||"Something went wrong");return}h(!1),l()},g=()=>{h(!1),m(""),t()};return R(o,g),e("div",{class:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e("div",{class:"relative h-full w-full max-w-md p-4 md:h-auto",children:e("div",{ref:o,class:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e("h3",{class:"mb-1.5 text-xl sm:text-2xl font-medium",children:"Update Role"}),e("p",{className:"mb-3 text-sm leading-none text-gray-400 hidden sm:block",children:"Select the role to update for this member"}),e("form",{onSubmit:x,children:[e("div",{className:"mt-0 sm:mt-4 my-4 flex flex-col gap-2",children:[e("span",{className:"mt-2 block w-full rounded-md bg-gray-100 p-2",children:p.invitedEmail}),e("div",{className:"flex h-[42px] w-full flex-col",children:e(E,{className:"h-full w-full",selectedRole:d,setSelectedRole:i})}),c&&e("p",{className:" rounded-md border border-red-300 bg-red-50 p-2 text-sm text-red-700",children:c})]}),e("div",{className:"flex items-center gap-2",children:[e("button",{type:"button",disabled:s,onClick:g,className:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e("button",{type:"submit",disabled:s||!d,class:"flex-grow cursor-pointer rounded-lg bg-black py-2 text-center text-white disabled:opacity-40",children:s?"Please wait ..":"Update Role"})]})]})]})})})}function U({role:n}){return e("span",{className:`rounded-full px-2 py-0.5 text-xs sm:flex items-center capitalize ${["admin"].includes(n)?"bg-blue-100 text-blue-700 ":"bg-gray-100 text-gray-700 "} ${["manager"].includes(n)?"bg-green-100 text-green-700":""}`,children:n})}function X(n){const{className:t}=n;return e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",className:t,children:[e("rect",{width:"20",height:"16",x:"2",y:"4",rx:"2"}),e("path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"})]})}function S(n){const{member:t,index:l,onResendInvite:p,onUpdateMember:o,canManageCurrentTeam:d,userId:i,handleDeleteMember:s,handleSendReminder:h}=n,c=t.progress.length===0&&t.status==="joined",m=t.progress.length===0&&t.status==="joined"&&t.userId!==i;return e("div",{className:`flex items-center justify-between gap-2 p-3 ${l===0?"":"border-t"}`,children:[e("div",{className:"flex items-center gap-3",children:[e("img",{src:t.avatar?`https://dodrc8eu8m09s.cloudfront.net/avatars/${t.avatar}`:"/images/default-avatar.png",alt:t.name||"",className:"hidden h-10 w-10 rounded-full sm:block"}),e("div",{children:[e("div",{className:"mb-1 flex items-center gap-2 sm:hidden",children:[e(U,{role:t.role}),m&&e(_,{handleSendReminder:h})]}),e("div",{className:"flex items-center",children:[e("h3",{className:"inline-grid grid-cols-[auto_auto_auto] items-center font-medium",children:[e("span",{className:"truncate",children:t.name}),c&&e("span",{className:"ml-2 rounded-full bg-gray-600 px-2 py-0.5 text-xs font-normal text-white sm:inline",children:"No Progress"}),t.userId===i&&e("span",{className:"ml-2 hidden text-xs font-normal text-blue-500 sm:inline",children:"You"})]}),e("div",{className:"ml-2 flex items-center gap-0.5",children:[t.status==="invited"&&e("span",{className:"rounded-full bg-yellow-100 px-2 py-0.5 text-xs text-yellow-700",children:"Invited"}),t.status==="rejected"&&e("span",{className:"rounded-full bg-red-100 px-2 py-0.5 text-xs text-red-700",children:"Rejected"})]})]}),e("p",{className:"truncate text-sm text-gray-500",children:t.invitedEmail})]})]}),e("div",{className:"flex shrink-0 items-center text-sm",children:[m&&e("span",{className:"hidden sm:block",children:e(_,{handleSendReminder:h})}),e("span",{class:"hidden sm:block",children:e(U,{role:t.role})}),d&&e(H,{onResendInvite:p,onDeleteMember:s,isDisabled:t.userId===i,onUpdateMember:o,member:t})]})]})}function _(n){const{handleSendReminder:t}=n;return e("button",{onClick:t,className:"mr-2 flex items-center gap-1.5 whitespace-nowrap rounded-full bg-orange-100 px-2 py-0.5 text-xs text-orange-700",children:[e(X,{className:"h-3 w-3"}),e("span",{children:"Reminder"})]})}function fe(){const{t:n}=V(),t=A(),l=Y(q),[p,o]=u(),[d,i]=u(!1),[s,h]=u([]),[c,m]=u(),b=F();async function x(){const{response:r,error:a}=await L(`https://api.roadmap.sh/v1-get-team/${n}`);if(a||!r){t.error(a?.message||"Something went wrong");return}r&&m(r)}async function g(){const{response:r,error:a}=await L(`https://api.roadmap.sh/v1-get-team-member-list/${n}`);if(a||!r){t.error(a?.message||"Failed to load team member list");return}h(r)}$(()=>{n&&Promise.all([x(),g()]).finally(()=>{f.set("")})},[n]);async function w(r,a){f.set("Deleting member");const{response:M,error:N}=await D(`https://api.roadmap.sh/v1-delete-member/${r}/${a}`,{});if(N||!M){t.error(N?.message||"Something went wrong");return}t.success("Member has been deleted"),await g()}async function v(r,a){f.set("Resending Invite");const{response:M,error:N}=await j(`https://api.roadmap.sh/v1-resend-invite/${r}/${a}`,{});if(N||!M){t.error(N?.message||"Something went wrong");return}t.success("Invite has been sent")}async function y(r,a){f.set("Sending Reminder");const{response:M,error:N}=await j(`https://api.roadmap.sh/v1-send-progress-reminder/${r}/${a}`,{});if(N||!M){t.error(N?.message||"Something went wrong");return}t.success("Reminder has been sent")}const C=s.filter(r=>r.status==="joined"),k=s.filter(r=>r.status==="invited"),T=s.filter(r=>r.status==="rejected");return e("div",{children:[p&&e(W,{member:p,onUpdated:()=>{f.set("Refreshing members"),g().finally(()=>{f.set("")}),o(void 0),t.success("Member has been updated")},onClose:()=>{o(void 0)}}),d&&e(Q,{onInvited:()=>{t.success("Invite sent"),g().then(()=>null),i(!1)},onClose:()=>{i(!1)}}),e("div",{children:[e("div",{className:"rounded-b-sm rounded-t-md border",children:[e("div",{className:"flex items-center justify-between gap-2 border-b p-3",children:[e("p",{className:"hidden text-sm sm:block",children:[s.length," people in the team."]}),e("p",{className:"block text-sm sm:hidden",children:[s.length," members"]}),e(K,{teamId:c?._id})]}),C.map((r,a)=>e(S,{member:r,index:a,teamId:n,userId:b?.id,onResendInvite:()=>{v(n,r._id).finally(()=>{f.set("")})},canManageCurrentTeam:l,handleDeleteMember:()=>{w(n,r._id).finally(()=>{f.set("")})},onUpdateMember:()=>{o(r)},handleSendReminder:()=>{y(n,r._id).finally(()=>{f.set("")})}},a))]}),k.length>0&&e("div",{className:"mt-6",children:[e("h3",{className:"text-xl font-medium",children:"Invited Members"}),e("div",{className:"mt-2 rounded-b-sm rounded-t-md border",children:k.map((r,a)=>e(S,{member:r,index:a,teamId:n,userId:b?.id,onResendInvite:()=>{v(n,r._id).finally(()=>{f.set("")})},canManageCurrentTeam:l,handleDeleteMember:()=>{w(n,r._id).finally(()=>{f.set("")})},onUpdateMember:()=>{o(r)},handleSendReminder:()=>{y(n,r._id).finally(()=>{f.set("")})}},a))})]}),T.length>0&&e("div",{className:"mt-6",children:[e("h3",{className:"text-xl font-medium",children:"Rejected Members"}),e("div",{className:"mt-2 rounded-b-sm rounded-t-md border",children:T.map((r,a)=>e(S,{member:r,index:a,teamId:n,userId:b?.id,onResendInvite:()=>{v(n,r._id).finally(()=>{f.set("")})},canManageCurrentTeam:l,handleDeleteMember:()=>{w(n,r._id).finally(()=>{f.set("")})},onUpdateMember:()=>{o(r)},handleSendReminder:()=>{y(n,r._id).finally(()=>{f.set("")})}},a))})]})]}),l&&e("div",{className:"mt-4",children:e("button",{disabled:s.length>=25,onClick:()=>i(!0),className:"block w-full rounded-md border border-dashed border-gray-300 py-2 text-sm transition-colors hover:border-gray-600 hover:bg-gray-50 focus:outline-0",children:"+ Invite Member"})}),s.length>=25&&l&&e("p",{className:"mt-2 rounded-lg bg-red-100 p-2 text-red-700",children:"You have reached the maximum number of members in a team. Please reach out to us if you need more."})]})}export{fe as TeamMembersPage};
